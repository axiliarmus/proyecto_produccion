{% extends 'admin_layout.html' %}

{% block title %}Piezas{% endblock %}
{% block header_title %}GestiÃ³n de Piezas{% endblock %}
{% block header_subtitle %}CatÃ¡logo de piezas, marcos y tramos{% endblock %}

{% block content %}

<!-- BARRA DE ACCIONES Y FILTRO -->
<div class="card bg-dark border-light shadow mb-4">
  <div class="card-body">
    <div class="row g-3 align-items-center">
      <!-- Filtro -->
      <div class="col-md-6">
        <form method="GET" class="d-flex gap-2">
          <input type="text" name="codigo" class="form-control bg-dark text-light border-secondary" 
                 placeholder="ðŸ” Filtrar por cÃ³digo..." value="{{ codigo_sel or '' }}">
          <button type="submit" class="btn btn-accent px-4 fw-bold">
            <i class='bx bx-search'></i> Buscar
          </button>
        </form>
      </div>
      
      <!-- Botones de AcciÃ³n -->
      <div class="col-md-6 text-end">
        <a href="{{ url_for('piezas_masivo') }}" class="btn btn-outline-warning d-inline-flex align-items-center gap-2 me-2">
          <i class='bx bx-wrench'></i> EdiciÃ³n Masiva
        </a>
        <a href="{{ url_for('piezas_nuevo_form') }}" class="btn btn-success d-inline-flex align-items-center gap-2">
          <i class='bx bx-plus-circle'></i> Nueva Pieza
        </a>
      </div>
    </div>
  </div>
</div>

<div class="admin-card">
  <div class="table-responsive">
    <table class="table table-dark table-hover align-middle mb-0" style="background: transparent;">
      <thead>
        <tr>
          <th>CÃ³digo</th>
          <th>Cliente</th>
          <th>Marco</th>
          <th>Tramo</th>
          <th>Peso (Kg)</th>
          <th>C. Interna</th>
          <th>C. Externa</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for p in piezas %}
        <tr>
          <td class="fw-bold text-white">{{ p.codigo }}</td>
          <td>{{ p.get('empresa','â€”') }}</td>
          <td>{{ p.get('marco','â€”') }}</td>
          <td>{{ p.get('tramo','â€”') }}</td>
          
          <td>
            {% set peso_raw = p.get('kilo_pieza', 0) %}
            {% set peso = peso_raw | float %}
            {{ "%.2f"|format(peso) }}
          </td>

          <td>{{ p.get('cuerda_interna', 'â€”') }}</td>
          <td>{{ p.get('cuerda_externa', 'â€”') }}</td>

          <td class="text-end">
            <a href="{{ url_for('piezas_editar_form', id=p._id) }}" class="btn btn-ghost-warning d-inline-flex align-items-center gap-1">
              <i class='bx bx-edit-alt'></i> Editar
            </a>
            <form action="{{ url_for('piezas_delete', id=p._id) }}" method="post" class="d-inline">
              <button class="btn btn-ghost-danger d-inline-flex align-items-center gap-1" onclick="return confirm('Â¿Eliminar esta pieza?')">
                <i class='bx bx-trash'></i> Eliminar
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if piezas|length == 0 %}
    <div class="p-4 text-center text-secondary">No hay piezas registradas aÃºn.</div>
  {% endif %}
</div>

{% endblock %}