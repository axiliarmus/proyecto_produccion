{% extends 'base.html' %}
{% block title %}Piezas Sin Producci√≥n{% endblock %}

{% block content %}

<h2 class="mb-4">Informe ‚Äì Piezas Sin Producci√≥n</h2>

<div class="d-flex justify-content-between align-items-center mb-3">
  <p class="text-secondary mb-0">
    Lista de piezas que a√∫n no han sido armadas ni rematadas.
  </p>

  <a href="{{ url_for('admin_informes') }}" class="btn btn-secondary">
    ‚Üê Volver a Informes
  </a>
</div>

<!-- ================= FILTROS ================= -->

<div class="card bg-dark border-light shadow mb-4">
  <div class="card-body">

    <form method="POST" class="row g-3">

      <div class="col-md-4">
        <label class="form-label">Empresa</label>
        <select name="empresa" class="form-select">
          <option value="todos">Todas</option>
          {% for e in empresas %}
            <option value="{{ e }}" {% if empresa_sel==e %}selected{% endif %}>{{ e }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Marco</label>
        <select name="marco" class="form-select">
          <option value="todos">Todos</option>
          {% for m in marcos %}
            <option value="{{ m }}" {% if marco_sel==m %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Tramo</label>
        <select name="tramo" class="form-select">
          <option value="todos">Todos</option>
          {% for t in tramos %}
            <option value="{{ t }}" {% if tramo_sel==t %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-12">
        <button class="btn btn-accent w-100">üîç Filtrar</button>
      </div>
    </form>

    <!-- EXPORTAR -->
    <form class="mt-3" method="POST" action="{{ url_for('exportar_piezas_sin_produccion_excel') }}">
      <input type="hidden" name="empresa" value="{{ empresa_sel }}">
      <input type="hidden" name="marco" value="{{ marco_sel }}">
      <input type="hidden" name="tramo" value="{{ tramo_sel }}">
      <button class="btn btn-success w-100">üì• Exportar a Excel</button>
    </form>

  </div>
</div>

<!-- ================= TABLA ================= -->

{% if piezas %}

<div class="table-responsive mb-4">
  <table class="table table-dark table-striped align-middle">
    <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Empresa</th>
        <th>Marco</th>
        <th>Tramo</th>
      </tr>
    </thead>

    <tbody>
      {% for p in piezas %}
      <tr>
        <td>{{ p.codigo }}</td>
        <td>{{ p.empresa }}</td>
        <td>{{ p.marco }}</td>
        <td>{{ p.tramo }}</td>
      </tr>
      {% endfor %}
    </tbody>

  </table>
</div>

{% else %}

<div class="alert alert-secondary text-center">
  No se encontraron piezas sin producci√≥n con estos filtros.
</div>

{% endif %}

{% endblock %}
