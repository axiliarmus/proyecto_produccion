{% extends 'base.html' %}
{% block title %}Resumen de Piezas Archivadas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0">ðŸ“¦ Resumen de Piezas Archivadas</h2>
        {% if corte_nombre %}
        <h4 class="text-info mt-2">Corte: {{ corte_nombre }}</h4>
        {% endif %}
    </div>
    <a href="{{ url_for('admin_archivados_menu') }}" class="btn btn-outline-light">
        â¬… Volver a Archivos
    </a>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <p class="text-secondary mb-0">Tarjetas agrupadas por cliente, mostrando marco y tramos (Datos HistÃ³ricos).</p>
</div>

{% for g in grupos %}
  <h4 class="mt-4 text-light">Cliente: {{ g.cliente }}</h4>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for m in g.marcos %}
    <div class="col">
      <div class="card bg-dark border-light shadow h-100 fixed-card">
        <div class="card-header bg-secondary text-white py-2">
            <h5 class="card-title mb-0 text-center">{{ m.marco }}</h5>
        </div>
        <div class="card-body d-flex flex-column p-0">
          <div class="flex-grow-1">
            <table class="table table-dark table-sm mb-0 table-fixed table-striped">
              <colgroup>
                <col style="width: 40%">
                <col style="width: 60%">
              </colgroup>
              <thead>
                <tr class="text-secondary small text-center">
                    <th>Tramo</th>
                    <th>Total - Rem = Faltan</th>
                </tr>
              </thead>
              <tbody>
                {% for t in m.tramos %}
                <tr class="{% if t.pendientes <= 0 %}table-success text-dark fw-bold{% endif %}">
                  <td class="align-middle text-center">{{ t.tramo }}</td>
                  <td class="num-col text-center py-2 align-middle">
                    <div class="fs-6">{{ t.total }} - {{ t.rematadas }} = {{ t.pendientes }}</div>
                    <div class="small text-warning">En armado: {{ t.en_armado }}</div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% endfor %}

{% if grupos|length == 0 %}
  <div class="alert alert-secondary text-center mt-5">
      <i class="fs-1">ðŸ“‚</i><br>
      No hay datos de piezas para este corte archivado.
  </div>
{% endif %}

{% endblock %}
