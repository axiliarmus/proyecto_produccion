{% extends 'admin_layout.html' %}

{% block title %}Informe de Horarios{% endblock %}
{% block header_title %}Informe de Horarios{% endblock %}
{% block header_subtitle %}Registros de asistencia{% endblock %}

{% block content %}

<div class="card bg-dark border-light shadow-lg mx-auto" style="max-width: 900px;">
  <div class="card-body">
    <form method="POST" action="{{ url_for('informe_horarios') }}" class="row g-3 align-items-end mb-4">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
      <div class="col-md-8">
        <label class="form-label text-light">Seleccionar Operador:</label>
        <select name="operador" class="form-select bg-dark text-light border-secondary">
          <option value="todos">Todos los operadores</option>
          {% for op in operadores %}
          <option value="{{ op._id }}" {% if operador_sel == op._id|string %}selected{% endif %}>
            {{ op.nombre }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 text-end">
        <button type="submit" class="btn btn-accent w-100">Filtrar</button>
      </div>
    </form>

    {% if jornadas %}
    <form method="POST" action="{{ url_for('exportar_horarios_excel') }}">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
      <input type="hidden" name="operador" value="{{ operador_sel or 'todos' }}">
      <div class="text-end mb-3">
        <button type="submit" class="btn btn-success">ðŸ“¤ Exportar a Excel</button>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle">
        <thead>
          <tr>
            <th>Operador</th>
            <th>Fecha</th>
            <th>Ingreso</th>
            <th>Salida</th>
          </tr>
        </thead>
        <tbody>
          {% for j in jornadas %}
          <tr>
            <td>{{ j.nombre }}</td>
            <td>{{ j.fecha.strftime('%d-%m-%Y') }}</td>
            <td>{{ j.ingreso.strftime('%H:%M:%S') if j.ingreso else 'â€”' }}</td>
            <td>{{ j.salida.strftime('%H:%M:%S') if j.salida else 'â€”' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-secondary text-center">No hay registros disponibles.</div>
    {% endif %}
  </div>
</div>

{% endblock %}