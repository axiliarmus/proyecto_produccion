{% extends 'base.html' %}
{% block title %}
  {{ 'Nueva Pieza' if modo == 'nuevo' else 'Editar Pieza' }}
{% endblock %}
{% block content %}

<div class="card bg-dark text-light shadow-lg mx-auto" style="max-width: 650px;">
  <div class="card-body">
    <h3 class="card-title text-center mb-4">
      {{ 'Crear Nueva Pieza' if modo == 'nuevo' else 'Editar Pieza' }}
    </h3>

    <form method="post" action="">

      <!-- CLIENTE -->
      <div class="mb-3">
        <label class="form-label">Cliente</label>
        <input 
          type="text" 
          class="form-control bg-secondary text-light" 
          name="empresa" 
          value="{{ pieza.empresa if pieza else '' }}" 
          required>
      </div>

      <!-- MARCO -->
      <div class="mb-3">
        <label class="form-label">Marco</label>
        <input 
          type="text" 
          class="form-control bg-secondary text-light" 
          name="marco" 
          value="{{ pieza.marco if pieza else '' }}" 
          required>
      </div>

      <!-- TRAMO -->
      <div class="mb-3">
        <label class="form-label">Tramo</label>
        <input 
          type="text" 
          class="form-control bg-secondary text-light" 
          name="tramo" 
          value="{{ pieza.tramo if pieza else '' }}" 
          required>
      </div>

      <!-- TIPO DE PRECIO (METRO / AVO) -->
      <div class="mb-3">
        <label class="form-label">Tipo de Precio</label>
        <select class="form-select bg-secondary text-light" name="tipo_precio" required>
          <option value="metro" {% if pieza and pieza.tipo_precio == 'metro' %}selected{% endif %}>Metro</option>
          <option value="avo" {% if pieza and pieza.tipo_precio == 'avo' %}selected{% endif %}>Avo</option>
        </select>
      </div>

      <!-- KILO POR PIEZA -->
      <div class="mb-3">
        <label class="form-label">Peso por pieza (Kg)</label>
        <input 
          type="number" 
          step="0.01"
          min="0"
          class="form-control bg-secondary text-light" 
          name="kilo_pieza" 
          value="{{ pieza.kilo_pieza if pieza else '' }}" 
          required>
      </div>

      <!-- CUERDAS (Interna / Externa) -->
      <div class="row">
      <!-- CUERDA INTERNA -->
      <div class="mb-3">
        <label class="form-label">Cuerda Interna</label>
        <input 
          type="number"
          step="0.01"
          min="0"
          class="form-control bg-secondary text-light" 
          name="cuerda_interna" 
          value="{{ pieza.cuerda_interna if pieza and pieza.cuerda_interna is defined else '' }}">
      </div>

      <!-- CUERDA EXTERNA -->
      <div class="mb-3">
        <label class="form-label">Cuerda Externa</label>
        <input 
          type="number"
          step="0.01"
          min="0"
          class="form-control bg-secondary text-light" 
          name="cuerda_externa" 
          value="{{ pieza.cuerda_externa if pieza and pieza.cuerda_externa is defined else '' }}">
      </div>

      <!-- CANTIDAD (solo en nuevo) -->
      {% if modo == 'nuevo' %}
      <div class="mb-3">
        <label class="form-label">Cantidad de piezas a generar</label>
        <input 
          type="number" 
          min="1" 
          class="form-control bg-secondary text-light" 
          name="cantidad" 
          required>
      </div>
      {% endif %}

      <div class="d-flex justify-content-between mt-4">
        <a href="{{ url_for('piezas_list') }}" class="btn btn-secondary">← Volver</a>
        <button type="submit" class="btn btn-accent" id="btnSubmit">
          {{ 'Guardar' if modo == 'nuevo' else 'Actualizar' }}
        </button>
      </div>

    </form>
  </div>
</div>

<script>
  document.querySelector("form").addEventListener("submit", function(e) {
      // La validación HTML5 previene el envío si faltan campos, 
      // así que si llegamos aquí, el form es válido.
      const btn = document.getElementById("btnSubmit");
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Procesando...';
  });
</script>

{% endblock %}
